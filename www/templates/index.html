<!doctype html>
<title>MAPS.ME OSM Changes Browser</title>
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
<body>
<h1>OSM Edits Made With MAPS.ME</h1>
<div id="filterbar">
<div id="stats" class="filter">
  <h2>Statistics</h2>
  <ul>
    <li>Total: {{ stats.total }}</li>
    <li>Created: {{ stats.created }}</li>
    <li>Deleted: {{ stats.deleted }}</li>
    <li>Modified: {{ stats.modified }}</li>
    <li>Anomalies: {{ stats.anomalies }}</li>
    <li>Nodes: {{ stats.nodes }}</li>
    <li>Ways: {{ stats.ways }}</li>
    <li>Relations: {{stats.relations }}</li>
    <li>Users: {{stats.users }}</li>
  </ul>
</div>
<div class="filter">
  <h2>Top Users</h2>
  <ol>
    {% for user in users %}
    {% if params.user %}
    <li>{{ user.user }} ({{user.count}}) <a href="{{ purl(params, user=None) }}">X</a></li>
    {% else %}
    <li><a href="{{ purl(params, user=user.user) }}">{{ user.user }}</a> ({{user.count}})</li>
    {% endif %}
    {% endfor %}
  </ol>
  {% if not params.nolimit %}
  <div><a href="{{ purl(params, nolimit=1) }}">Show all</a></div>
  {% endif %}
</div>
<div class="filter">
  <h2>Top Main Tags</h2>
  <ol>
    {% for tag in tags %}
    <li>{{ tag.main_tag }} ({{tag.count}})</li>
    {% endfor %}
  </ol>
</div>
<div class="filter">
  <h2>Versions</h2>
  <div>
    Filter:
    {% if params.platform %}
    {{ params.platform }} <a href="{{ purl(params, platform=None) }}">X</a>
    {% else %}
    {% for p in ('ios', 'android', 'other') %}
    <a href="{{ purl(params, platform=p) }}">{{ p }}</a>
    {% endfor %}
    {% endif %}
  </div>
  <ol>
    {% for v in versions %}
    {% if params.version %}
    <li>{{ v.version }} ({{v.count}}) <a href="{{ purl(params, version=None) }}">X</a></li>
    {% else %}
    <li><a href="{{ purl(params, version=v.version) }}">{{ v.version }}</a> ({{v.count}})</li>
    {% endif %}
    {% endfor %}
  </ol>
</div>
<div class="filter">
  <h2>Dates</h2>
  <div>Note: timezone is UTC.</div>
  <ul>
    {% if params.date %}
    <li>{{ params.date }} <a href="{{ purl(params, date=None) }}">X</a></li>
    {% else %}
    {% for d in dates %}
    <li><a href="{{ purl(params, date=d.timestamp.strftime('%d.%m.%Y')) }}">{{ d.timestamp.strftime('%d.%m.%Y') }}</a> ({{ d.count }})</li>
    {% endfor %}
    {% endif %}
  </ul>
</div>
</div>
<div>
  <h2>Changes</h2>
  {% for change in changes %}
  <div class="change">
    <a href="https://www.openstreetmap.org/user/{{ change.user }}">{{ change.user }}</a> at {{ change.timestamp.strftime('%d.%m.%Y %H:%M') }}
    in <a href="https://www.openstreetmap.org/changeset/{{ change.changeset }}">{{ change.changeset }}</a>: {{ change.explain_action() }}
    {% if change.obj_type %}
    <a href="https://www.openstreetmap.org/{{ {'n':'node', 'w':'way', 'r':'relation'}[change.obj_type] }}/{{ change.obj_id }}">{{ change.main_tag or '' }}</a>
    <sup>
      <a href="http://127.0.0.1:8111/load_object?objects={{ change.obj_type }}{{ change.obj_id }}" target="josmframe">JOSM</a>
      <a href="http://level0.osmz.ru/?url={{ change.obj_type }}{{ change.obj_id }}!" target="level0">Level0</a>
    </sup>
    {% endif %}
    <table>
      {% for key, value in change.changed_tags().iteritems() %}
      <tr class="{{ value[2] }}"><td>{{ key }}</td><td>{{ '' if value[0] == value[1] else (value[0] or '') }}</td><td>{{ value[1] or '' }}</td></tr>
      {% endfor %}
    </table>
  </div>
  {% endfor %}
  {% if params.page > 1 %}<a href="{{ purl(params, page=params.page-1) }}">&laquo; Newer</a>{% else %}&laquo; Newer{% endif %}
  {% if params.page < stats.pages  %}<a href="{{ purl(params, page=params.page+1) }}">Older &raquo;</a>{% else %}Older &raquo;{% endif %}
</div>
<iframe height="0" width="0" name="josmframe" style="visibility:hidden; display:none;" src="about:blank"></iframe>
